
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>The Paired t-test &#8212; Linear Models with Correlated Errors</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '3.paired-t';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Repeated Measures ANOVA" href="4.rm-anova.html" />
    <link rel="prev" title="Probability Models" href="2.probability.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Linear Models with Correlated Errors - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Linear Models with Correlated Errors - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.designs.html">Repeated Measurement Designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.probability.html">Probability Models</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">The Paired <em>t</em>-test</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.rm-anova.html">The Repeated Measures ANOVA</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.gls.html">Generalised Least Squares</a></li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/correlated-errors" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/correlated-errors/issues/new?title=Issue%20on%20page%20%2F3.paired-t.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/3.paired-t.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Paired t-test</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-sample-vs-paired-t-tests">Two-sample vs Paired <em>t</em>-tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-of-paired-differences">The Model of <em>Paired Differences</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-of-partitioned-errors">The Model of <em>Partitioned Errors</em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-the-error">Partitioning the Error</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-the-error-as-a-decomposition-of-the-variance-covariance-matrix">Partitioning the Error as a Decomposition of the Variance-covariance Matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explicit-two-sample-t-test-as-a-linear-model">Explicit Two-sample <span class="math notranslate nohighlight">\(t\)</span>-test as a Linear Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#where-does-the-standard-error-come-from">Where Does the Standard Error Come From?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recreating-the-paired-t-test-in-the-linear-model">Recreating the Paired <span class="math notranslate nohighlight">\(t\)</span>-test in the Linear Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#section-summary">Section Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-paired-t-test">
<h1>The Paired <em>t</em>-test<a class="headerlink" href="#the-paired-t-test" title="Link to this heading">#</a></h1>
<p>To begin our journey into the world of models for repeated measurements, we will start with the simplest possible example: the paired <span class="math notranslate nohighlight">\(t\)</span>-test. Last semester, we saw how the humble <span class="math notranslate nohighlight">\(t\)</span>-test can be subsumed into the linear model framework through the use of <em>dummy variables</em>. This same approach can be used with paired data<a class="footnote-reference brackets" href="#paired-foot" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> because the difference between the <em>independent</em> and <em>paired</em> <span class="math notranslate nohighlight">\(t\)</span>-test does not lie with the <em>mean function</em>. We spent a lot of time last semester discussing different mean functions and, you will be glad to know, this all follows-over into the world of repeated measurements. The difference lies with the <em>variance function</em>. Specifically, how we can alter the variance function to accommodate non-zero correlation between the repeats? As we will see in this part of the lesson, there are <em>two</em> equivalent ways of doing this with paired data. One of them <em>side-steps</em> the issues of dependence whereas the other does not. However, it is useful to understand how both of these work because it provides some crucial insight into modelling repeated measurements that we will generalise as our models get more complex.</p>
<section id="two-sample-vs-paired-t-tests">
<h2>Two-sample vs Paired <em>t</em>-tests<a class="headerlink" href="#two-sample-vs-paired-t-tests" title="Link to this heading">#</a></h2>
<p>To begin with, it is useful to examine <em>how</em> the results differ between a <em>two-sample</em> and <em>paired</em> <span class="math notranslate nohighlight">\(t\)</span>-test. We can don this in <code class="docutils literal notranslate"><span class="pre">R</span></code> by comparing the results of the <code class="docutils literal notranslate"><span class="pre">t.test()</span></code> function with <code class="docutils literal notranslate"><span class="pre">paired=FALSE</span></code> and <code class="docutils literal notranslate"><span class="pre">paired=TRUE</span></code>. To do this, we use the <code class="docutils literal notranslate"><span class="pre">mice2</span></code> data set from the <code class="docutils literal notranslate"><span class="pre">datarium</span></code> package, that contains the weight of a sample of 10 mice both <em>before</em> and <em>after</em> some treatment. The experimental question concerns whether the treatment affects the weight of the mice. The data is shown below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;datarium&#39;</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="s">&#39;mice2&#39;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">mice2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   id before after
1   1  187.2 429.5
2   2  194.2 404.4
3   3  231.7 405.6
4   4  200.5 397.2
5   5  201.7 377.9
6   6  235.0 445.8
7   7  208.7 408.4
8   8  172.4 337.0
9   9  184.6 414.3
10 10  189.6 380.3
</pre></div>
</div>
</div>
</div>
<p>We can compare the output from a <em>two-sample</em> <span class="math notranslate nohighlight">\(t\)</span>-test and a <em>paired</em> <span class="math notranslate nohighlight">\(t\)</span>-test by changing the <code class="docutils literal notranslate"><span class="pre">paired=</span></code> argument of <code class="docutils literal notranslate"><span class="pre">t.test()</span></code>, as shown below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="nf">t.test</span><span class="p">(</span><span class="n">mice2</span><span class="o">$</span><span class="n">before</span><span class="p">,</span><span class="w"> </span><span class="n">mice2</span><span class="o">$</span><span class="n">after</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w">  </span><span class="c1"># paired t-test</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">t.test</span><span class="p">(</span><span class="n">mice2</span><span class="o">$</span><span class="n">before</span><span class="p">,</span><span class="w"> </span><span class="n">mice2</span><span class="o">$</span><span class="n">after</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="c1"># two-sample t-test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Paired t-test

data:  mice2$before and mice2$after
t = -25.546, df = 9, p-value = 1.039e-09
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 -217.1442 -181.8158
sample estimates:
mean difference 
        -199.48 


	Two Sample t-test

data:  mice2$before and mice2$after
t = -17.453, df = 18, p-value = 9.974e-13
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -223.4926 -175.4674
sample estimates:
mean of x mean of y 
   200.56    400.04 
</pre></div>
</div>
</div>
</div>
<p>The output is a bit different between the two methods, so let us spend a little time unpacking what <em>is</em> and what <em>is not</em> different here. To begin with, the clearest differences between the two methods concern the <span class="math notranslate nohighlight">\(t\)</span>-statistic itself, the degrees of freedom, the <span class="math notranslate nohighlight">\(p\)</span>-value and the confidence interval. This is summarised in the table below</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Test</p></th>
<th class="head"><p><em>t</em>-statistic</p></th>
<th class="head"><p>DoF</p></th>
<th class="head"><p><em>p</em>-value</p></th>
<th class="head"><p>95% CI</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Paired</p></td>
<td><p>-25.546</p></td>
<td><p>9</p></td>
<td><p>1.039e-09</p></td>
<td><p>[-217.14 -181.82]</p></td>
</tr>
<tr class="row-odd"><td><p>Two-sample</p></td>
<td><p>-17.453</p></td>
<td><p>18</p></td>
<td><p>9.974e-13</p></td>
<td><p>[-223.49 -175.47]</p></td>
</tr>
</tbody>
</table>
</div>
<p>Although this may therefore seem like <em>everything</em> is different, there is actually one element that is <em>identical</em> here, though it is somewhat hidden. To see it, consider that the structure of a <span class="math notranslate nohighlight">\(t\)</span>-test is</p>
<div class="math notranslate nohighlight">
\[
t = \frac{\mu_{1} - \mu_{2}}{\text{SE}\{\mu_{1} - \mu_{2}\}},
\]</div>
<p>meaning that we think of the <span class="math notranslate nohighlight">\(t\)</span> as the ratio between the <em>mean difference</em> and the <em>standard error of the mean difference</em>. The <span class="math notranslate nohighlight">\(t\)</span>-statistic is different between the <em>two-sample</em> and the <em>paired</em> tests, but this does not necessarily mean that all elements of this ratio are also different. Indeed, if we look at the output above we can see that the <em>paired</em> test reports a mean difference of <code class="docutils literal notranslate"><span class="pre">-199.48</span></code> and the <em>two-sample</em> test reports the individual means as <code class="docutils literal notranslate"><span class="pre">200.56</span></code> and <code class="docutils literal notranslate"><span class="pre">400.04</span></code>. If we calculate the mean difference in the <em>two-sample</em> test we get</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="m">200.56</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">400.04</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] -199.48
</pre></div>
</div>
</div>
</div>
<p>So, this is <em>identical</em> between the <em>paired</em> and <em>two-sample</em> tests. This should not be surprising, as we already established that repeated measurements do not affect the mean function. So, in either case, the groups means are the same, the mean difference is the same and the <em>numerator</em> of the <span class="math notranslate nohighlight">\(t\)</span>-statistic is the same. From this, we can conclude that the <em>difference</em> between the two methods concerns the <em>denominator</em> of the <span class="math notranslate nohighlight">\(t\)</span>-statistic. In other words, <em>the standard error of the difference changes under repeated measurements</em>.</p>
<p>Given that we know the numerator for both tests, we can recover the denominators to see that this is the case</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mean.diff</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-199.48</span>
<span class="n">paired.t</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-25.546</span>
<span class="n">twosamp.t</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-17.453</span>
<span class="n">paired.se</span><span class="w">  </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">mean.diff</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">paired.t</span>
<span class="n">twosamp.se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">mean.diff</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">twosamp.t</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">paired.se</span><span class="p">,</span><span class="w"> </span><span class="n">twosamp.se</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1]  7.808659 11.429554
</pre></div>
</div>
</div>
</div>
<p>So, the <em>standard error</em> of the difference is much <em>smaller</em> in the <em>paired</em> test when compared to the <em>two-sample</em> test. This should not be a surprise. Thinking back to our discussion from the beginning of the lesson, we know that the variance of the difference between two random variables should get <em>smaller</em> when they are positively correlated. From this, we can conclude that, when applied to <em>paired</em> data, the <em>two-sample</em> <span class="math notranslate nohighlight">\(t\)</span>-test is using a standard error that is <em>too large</em>. This tracks with everything we have discussed so far. However, the key question for us is <em>how</em> the <em>paired</em> <span class="math notranslate nohighlight">\(t\)</span>-test is able to do this.</p>
<p>As mentioned at the start of this part of the lesson, there are two equivalent ways of thinking about this. We will discuss <em>both</em> below because their equivalence provides important information for conceptualising more complex methods.</p>
</section>
<section id="the-model-of-paired-differences">
<h2>The Model of <em>Paired Differences</em><a class="headerlink" href="#the-model-of-paired-differences" title="Link to this heading">#</a></h2>
<p>The first method we can use is actually a bit of a <em>cheat</em> in order to side-step the issue of dependence entirely. However, conceptually, this is a really key step because it introduces the idea that we can correctly model repeated measurements by <em>removing something from the data</em>. In this first method, we remove it manually by subtracting the two repeats and analysing the <em>difference</em>. Further below we will see how this removal can be done <em>within the model itself</em>.</p>
<p>… So the key insight is that when we take <span class="math notranslate nohighlight">\(D_{i} = y_{i1} - y_{i2}\)</span>, we have <em>removed</em> some element from the data that allows us to analyse the difference between the conditions without taking correlation into account. How is this possible? Precisely because, by subtracting these two values, we have <em>removed</em> the correlation. Thus, there is some shared component between <span class="math notranslate nohighlight">\(y_{i1}\)</span> and <span class="math notranslate nohighlight">\(y_{i2}\)</span> that cancels-out when we subtract them. In cancelling-out, the correlation is gone and we can treat <span class="math notranslate nohighlight">\(D_{i}\)</span> as a vector of independent measurements.</p>
<p>We can get more clarity on this by writing it formally. Let us <em>add</em> a shared component to the definition of both <span class="math notranslate nohighlight">\(y_{i1}\)</span> and <span class="math notranslate nohighlight">\(y_{i2}\)</span>. We will call this <span class="math notranslate nohighlight">\(S_{i}\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    y_{i1} &amp;= \mu_{1} + S_{i} + \epsilon_{i1} \\
    y_{i2} &amp;= \mu_{2} + S_{i} + \epsilon_{i2} 
\end{alignat*}.
\end{split}\]</div>
<p>So, the reason why <span class="math notranslate nohighlight">\(y_{i1}\)</span> and <span class="math notranslate nohighlight">\(y_{i2}\)</span> are correlated is because they <em>share</em> the same component <span class="math notranslate nohighlight">\(S_{i}\)</span>. This captures the idea that these measurements come the same <em>subject</em>. If we then <em>subtract</em> these values, <span class="math notranslate nohighlight">\(S_{i}\)</span> will cancel-out</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    (y_{i1} - y_{i2}) = D_{i} &amp;= (\mu_{1} - \mu_{2}) + (S_{i} - S_{i}) + (\epsilon_{i1} - \epsilon_{i2}) \\
                              &amp;= \mu^{(D)} + \epsilon_{i}^{(D)}
\end{alignat*}.
\end{split}\]</div>
<p>So, this tells us that <span class="math notranslate nohighlight">\(S_{i}\)</span> precisely captures the correlation, because removing it renders the data <em>independent</em>.</p>
</section>
<section id="the-model-of-partitioned-errors">
<h2>The Model of <em>Partitioned Errors</em><a class="headerlink" href="#the-model-of-partitioned-errors" title="Link to this heading">#</a></h2>
<section id="partitioning-the-error">
<h3>Partitioning the Error<a class="headerlink" href="#partitioning-the-error" title="Link to this heading">#</a></h3>
<p>To begin with, let us just examine the overall variance of the data for the first 15 subjects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">50</span><span class="p">),</span><span class="n">each</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">subject</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">30</span><span class="p">],</span>
<span class="w">     </span><span class="n">y.long</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">30</span><span class="p">],</span>
<span class="w">     </span><span class="n">col</span><span class="o">=</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
<span class="w">     </span><span class="n">xlab</span><span class="o">=</span><span class="s">&#39;Subject&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="n">ylab</span><span class="o">=</span><span class="s">&#39;Y&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>

<span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">y.long</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">Error</span>:

<span class="o">!</span><span class="w"> </span>object<span class="w"> </span><span class="s1">&#39;y.long&#39;</span><span class="w"> </span>not<span class="w"> </span>found

    <span class="err">▆</span>

<span class="g g-Whitespace"> </span><span class="mi">1</span><span class="o">.</span> <span class="err">├─</span><span class="n">base</span><span class="p">::</span><span class="n">plot</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="g g-Whitespace"> </span><span class="mi">2</span><span class="o">.</span> <span class="err">└─</span><span class="n">graphics</span><span class="p">::</span><span class="n">plot</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="g g-Whitespace"> </span><span class="mi">3</span><span class="o">.</span>   <span class="err">└─</span><span class="n">grDevices</span><span class="p">::</span><span class="n">xy</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here we can see that there are 3 main sources of variation in these data:</p>
<ol class="arabic simple">
<li><p>The two conditions have different means, thus measures from one condition tend to be larger than the other. In this example, the mean difference is only 0.21, so this is quite a subtle effect. But it is there. This is the <em>structured</em> variance we are interested in (can’t remember what term was used for this?)</p></li>
<li><p>The data come from different subjects, thus the degree to which the data fall above or below the grand means depends upon the individual subject. This is one source of <em>error variance</em> that explains why the data deviate from their expected value.</p></li>
<li><p>Within each subject, there is variation between the two measures. The magnitude of this difference is sometimes bigger and sometimes smaller than the condition difference of 0.21. This is <em>another</em> source of <em>error variance</em>.</p></li>
</ol>
<p>So, we have one <em>structured</em> source of variation here (the difference between the experimental conditions), as well as <em>two</em> sources of error: the data come from different subjects and responses within each subject will also be different. The “subject” source captures the <em>internal consistency</em> of individual subjects (i.e. how correlated the responses are), whereas as the “within-subject” source captures the natural random variation we get between measurements, irrespective of whether they come from the same subject or not.</p>
<p>To understand this more, we can work through <em>removing</em> each of these sources from the data to see how it can be decomposed. To begin with, we can remove the constant effect of each condition. To do so, we can simply take the residuals from the <code class="docutils literal notranslate"><span class="pre">two.sample.mod</span></code>, given that the predicted values from this model <em>are</em> the condition means. Once the effect of the conditions is removed, we have the plot below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">res.two.sample</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">resid</span><span class="p">(</span><span class="n">two.sample.mod</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">subject</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">30</span><span class="p">],</span>
<span class="w">     </span><span class="n">res.two.sample</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">30</span><span class="p">],</span>
<span class="w">     </span><span class="n">xlab</span><span class="o">=</span><span class="s">&#39;Subject&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="n">ylab</span><span class="o">=</span><span class="s">&#39;Residuals&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="n">col</span><span class="o">=</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
<span class="w">     </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">,</span>
<span class="w">     </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>

<span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have removed any variation associated with the two conditions, we can turn to variability associated with the individual subjects. This is known as <em>between-subjects</em> variance. To remove it, we can calculate the mean value of each subject and then subtract it from the data. This results in the plot below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">res.matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">res.two.sample</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">sub.means</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rowMeans</span><span class="p">(</span><span class="n">res.matrix</span><span class="p">)</span>
<span class="n">res.nosub</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">)</span>
<span class="n">sub.idx</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>

<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">){</span>
<span class="w">    </span><span class="n">res.nosub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">res.two.sample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sub.means</span><span class="p">[</span><span class="n">sub.idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="p">}</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">sub.idx</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">],</span>
<span class="w">     </span><span class="n">res.nosub</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">],</span>
<span class="w">     </span><span class="n">xlab</span><span class="o">=</span><span class="s">&#39;Subject&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="n">ylab</span><span class="o">=</span><span class="s">&#39;Residuals - Subjects&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">,</span>
<span class="w">     </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that a huge amount of the variation in this data was attributable to the variation between different subjects. Now that this has been removed, we can effectively treat our data as <em>one big sample from a single subject</em>. As such, the variability we can see between all pairs of measurements provides us with an indication of how <em>internally consistent</em> a single subject is across the different conditions of the task. With the overall effect of the conditions removed, this remaining variability is not related to the conditions themseleves. Rather, it is related to other sources of random variation that cause an individual’s response to change across multiple repeats of an experiment. This is known as the  <em>within-subject variance</em>.</p>
<p>The variance associated with the two conditions is of direct interest because this captures our experimental effect of interest. Both the <em>between-subjects</em> and <em>within-subject</em> variance are effectively sources of <em>error</em> because they indicate different ways that the raw data may differ from the means of the conditions. One of these errors comes from the fact that different people may respond consistently higher or lower than the mean. The other comes from the fact that, even if an individual did not respond differently from the mean, natural variation across repeats will always be there.</p>
<p>This partitioning of variance can be formally stated as</p>
<div class="math notranslate nohighlight">
\[
\text{Var}(y) = \sigma^{2} = \sigma^{2}_{b} + \sigma^{2}_{w}.
\]</div>
<p>As such, we now have <em>three</em> choices when it comes to calculating standard errors. Do we use the pooled variance of <span class="math notranslate nohighlight">\(\sigma^{2}\)</span>? The between-subjects variance of <span class="math notranslate nohighlight">\(\sigma^{2}_{b}\)</span>, or the within-subject variance of <span class="math notranslate nohighlight">\(\sigma^{2}_{w}\)</span>?</p>
<p>Key Point
In a regular paired t-test, the error variance consists of the differences between the means of the groups and the raw data. Howevever, when we have repeated measurements, this difference can be further divided into two sources … This is consistent with the idea of the <em>between-subjects variance</em> <span class="math notranslate nohighlight">\(\left(\sigma^{2}_{b}\right)\)</span> and the <em>within-subject variance</em> <span class="math notranslate nohighlight">\(\left(\sigma^{2}_{w}\right)\)</span> … As such, the difference with a <em>paired</em> test is that is uses the <em>within-subject variance</em> exclusively for determining the denominator of the <span class="math notranslate nohighlight">\(t\)</span>-statistic.</p>
</section>
<section id="partitioning-the-error-as-a-decomposition-of-the-variance-covariance-matrix">
<h3>Partitioning the Error as a Decomposition of the Variance-covariance Matrix<a class="headerlink" href="#partitioning-the-error-as-a-decomposition-of-the-variance-covariance-matrix" title="Link to this heading">#</a></h3>
<p>Now, we will connect what we have done above with the idea of modelling the variance-covariance matrix. Rather than doing this <em>explicitly</em>, the method above was an <em>implicit</em> modelling of the covariance structure…</p>
</section>
<section id="explicit-two-sample-t-test-as-a-linear-model">
<h3>Explicit Two-sample <span class="math notranslate nohighlight">\(t\)</span>-test as a Linear Model<a class="headerlink" href="#explicit-two-sample-t-test-as-a-linear-model" title="Link to this heading">#</a></h3>
<p>To see this, we first start with the familiar case of the <em>two-sample</em> model. We can fit this as an LM within <code class="docutils literal notranslate"><span class="pre">R</span></code> as follows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y.long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.vector</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="c1"># Turn y into a column</span>
<span class="n">cond</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">),</span><span class="m">50</span><span class="p">)</span><span class="w"> </span><span class="c1"># Create a predictor for the two conditions</span>

<span class="n">two.sample.mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">y.long</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">cond</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">two.sample.mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Focussing on the coefficient and tests associated with <code class="docutils literal notranslate"><span class="pre">CondB</span></code> in the table, we can see <span class="math notranslate nohighlight">\(t = 0.928\)</span> and <span class="math notranslate nohighlight">\(p = 0.356\)</span>, which is the same<a class="footnote-reference brackets" href="#foot1" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> as we saw for the two-sample test earlier. We can also see that the degrees of freedom agree at <span class="math notranslate nohighlight">\(98\)</span>. So we have managed to successfully implement the <em>two-sample</em> <span class="math notranslate nohighlight">\(t\)</span>-test as a linear model.</p>
<p>Now, we know that this is <em>incorrect</em> for correlated data. However, specifying the model in this form allows us to dig deeper into <em>why</em> this is wrong, which will then provide us with the insight needed to correct this and thus tell us how the <em>paired</em> method is able to accommodate correlation. This will also provide us with the grounding needed to understand the traditional repeated measured ANOVA, as well as mixed-effect model a little later in the unit.</p>
</section>
<section id="where-does-the-standard-error-come-from">
<h3>Where Does the Standard Error Come From?<a class="headerlink" href="#where-does-the-standard-error-come-from" title="Link to this heading">#</a></h3>
<p>To begin understanding what is going on here, we need to review where the value for the standard error comes from. In the context of a linear model, the standard error of <span class="math notranslate nohighlight">\(\hat{\beta}_{1}\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[
\text{SE}\left(\hat{\beta}_{1}\right) = \sqrt{\text{Var}\left(\hat{\beta}_{1}\right)} = \sqrt{\frac{\hat{\sigma}^{2}}{\sum_{i=1}^{n}\left(x_{i1} - \bar{x}_{1}\right)}}.
\]</div>
<p>So, the standard error is the square-root of the variance of an estimate, and the variance of an estimate is simply a scaled version of the error variance from the model. This scaling is not entirely clear when represented in the format above. However, when <span class="math notranslate nohighlight">\(x_{1}\)</span> is simply a dummy variable encoding a mean difference, this simplifies to the known formula for the denominator of a <span class="math notranslate nohighlight">\(t\)</span>-test assuming equal variance in the two samples</p>
<div class="math notranslate nohighlight">
\[
\text{SE}\left(\hat{\beta}_{1}\right) = \text{SE}\left(\hat{\mu}_{1} - \hat{\mu}_{2}\right) = \sqrt{\frac{\hat{\sigma}^{2}}{\frac{1}{\frac{1}{n_{1}} + \frac{1}{n_{2}}}}} = \sqrt{\hat{\sigma}^{2}\left(\frac{1}{n_{1}} + \frac{1}{n_{2}}\right)}.
\]</div>
<p>Here, we can more easily see that the standard error depends only upon the sample sizes and the error variance.</p>
<div class="tip admonition">
<p class="admonition-title">Key Point!</p>
<p>Under multiple repeats of the same experimnent, the sample sizes of the groups will remain the same. As such, this element of the standard error is simply a <em>constant scaling</em>. Whether the data are independent or not will not change this element of the standard error because the formula is <em>always the same</em>. The only element that can change is the <em>error variance</em>. As such, this must be the source of the difference between the <em>two-sample</em> and <em>paired</em> approaches.</p>
</div>
<p>We can verify that this formula for the standard error is correct in the <em>two-sample</em> model by calculating</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sigma2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="n">two.sample.mod</span><span class="p">)</span><span class="o">$</span><span class="n">sigma</span><span class="o">^</span><span class="m">2</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">50</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>which agrees with out results so far. As the element of most interest here is the estimate of <span class="math notranslate nohighlight">\(\sigma^{2}\)</span>, the next obvious question is where does this come from?</p>
<p>As a review, the error variance in a linear model is estimated using</p>
<div class="math notranslate nohighlight">
\[
\hat{\sigma}^{2} = \frac{\sum_{i=1}^{n}\epsilon_{i}^{2}}{n-p},
\]</div>
<p>which is also known as the <em>residual mean square</em> or <em>error mean square</em>. We can again verify this for our example by calculating</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sigma2</span>

<span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">two.sample.mod</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">two.sample.mod</span><span class="o">$</span><span class="n">df.residual</span>
</pre></div>
</div>
</div>
</div>
<p>As such, if this is the element that differs between the <em>two-sample</em> and <em>paired</em> model, then our final suspect must be the <em>model residuals</em>. More specifically, the residuals must be <em>larger</em> in the <em>two-sample</em> case and <em>smaller</em> in the <em>paired</em> case. This is the only way the standard errors can differ. But this still does not explain <em>why</em> this is the case?</p>
</section>
<section id="recreating-the-paired-t-test-in-the-linear-model">
<h3>Recreating the Paired <span class="math notranslate nohighlight">\(t\)</span>-test in the Linear Model<a class="headerlink" href="#recreating-the-paired-t-test-in-the-linear-model" title="Link to this heading">#</a></h3>
<p>From all we discussed earlier, the aim is therefore to <em>remove</em> the between-subject variance from the residuals so that the error variance of the model only contains the <em>within-subject variance</em>. If we do not do this, then <span class="math notranslate nohighlight">\(\sigma^{2} = \sigma^{2}_{b} + \sigma^{2}_{w}\)</span>, which will be too large to accurately capture the standard error of the mean difference under repeated measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>

<span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">50</span><span class="p">),</span><span class="n">each</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>

<span class="n">paired.mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">y.long</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">subject</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">paired.mod</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">Anova</span><span class="p">(</span><span class="n">paired.mod</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the output here is a bit of mess due to all the subject effects. However, if you look at the coefficient and test for <code class="docutils literal notranslate"><span class="pre">CondB</span></code>, notice that <span class="math notranslate nohighlight">\(t = 2.495\)</span> and <span class="math notranslate nohighlight">\(p = 0.016\)</span>, which is the same as the <em>paired</em> <span class="math notranslate nohighlight">\(t\)</span>-test from earlier. Furthermore, the degrees of freedom are now correct at <span class="math notranslate nohighlight">\(49\)</span>. As such, adding the subject effects to the model has allowed the <em>between-subjects</em> error to be partitioned out and thus the remaining variance calculated from the residuals is <em>only</em> the <em>within-subject</em> error. This is the error needed to correctly estimate the standard error of the paired difference and thus the model results are now correct.</p>
<div class="warning dropdown admonition">
<p class="admonition-title">Advanced: Understanding the coefficients in the paired model</p>
<p>So from this, we can see that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mu_{1} &amp;= \beta_{0} + \frac{1}{n}\sum_{k=2}^{n+1}\beta_{k} \\
\mu_{2} &amp;= \beta_{0} + \beta_{1} + \frac{1}{n}\sum_{k=2}^{n+1}\beta_{k}.
\end{align}
\end{split}\]</div>
<p>Solving for both <span class="math notranslate nohighlight">\(\beta_{0}\)</span> and <span class="math notranslate nohighlight">\(\beta_{1}\)</span> gives</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\beta_{0} &amp;= \mu_{1} - \frac{1}{n}\sum_{k=2}^{n+1}\beta_{k} \\
\beta_{1} &amp;= \beta_{0} + \frac{1}{n}\sum_{k=2}^{n+1}\beta_{k} - \mu_{2} = \mu_{1} - \mu_{2}.
\end{align}
\end{split}\]</div>
<p>So, rather unituitively, the intercept is actually the mean of the first group, minus the average of the subject effects. This then raises the question of what exactly the subject effects are? We can use a similar approach as above to solve for these. For instance, the expected value of the response from subject 2 in condition A is</p>
<div class="math notranslate nohighlight">
\[
\mu_{12} = \beta_{0} + \beta_{2}.
\]</div>
<p>Meaning that the effect for subject 2 is</p>
<div class="math notranslate nohighlight">
\[
\beta_{2} = \mu_{12} - \beta_{0}.
\]</div>
<p>As such, the subject effects are effectively <em>residuals</em> around the intercept. Importantly, these are <em>constant offsets</em>, irrespective of the condition. For instance. As such, subject 2 is expect to lie the same distance from the mean of condition A and the mean of condition B.</p>
</div>
</section>
</section>
<section id="section-summary">
<h2>Section Summary<a class="headerlink" href="#section-summary" title="Link to this heading">#</a></h2>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="paired-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Paired data simply means data where each experimental unit provides a <em>pair</em> of measurements. For instance, each subject takes part in <em>two</em> conditions, or is measured at <em>two</em> separate time points.</p>
</aside>
<aside class="footnote brackets" id="foot1" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Due to the way the factors are coded in <code class="docutils literal notranslate"><span class="pre">R</span></code>, the coefficient is actually the opposite comparison here, hence why the <span class="math notranslate nohighlight">\(t\)</span>-statistic is <em>positive</em> rather than <em>negative</em>.</p>
</aside>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="2.probability.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Probability Models</p>
      </div>
    </a>
    <a class="right-next"
       href="4.rm-anova.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Repeated Measures ANOVA</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-sample-vs-paired-t-tests">Two-sample vs Paired <em>t</em>-tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-of-paired-differences">The Model of <em>Paired Differences</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-of-partitioned-errors">The Model of <em>Partitioned Errors</em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-the-error">Partitioning the Error</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partitioning-the-error-as-a-decomposition-of-the-variance-covariance-matrix">Partitioning the Error as a Decomposition of the Variance-covariance Matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explicit-two-sample-t-test-as-a-linear-model">Explicit Two-sample <span class="math notranslate nohighlight">\(t\)</span>-test as a Linear Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#where-does-the-standard-error-come-from">Where Does the Standard Error Come From?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recreating-the-paired-t-test-in-the-linear-model">Recreating the Paired <span class="math notranslate nohighlight">\(t\)</span>-test in the Linear Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#section-summary">Section Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Martyn McFarquhar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>